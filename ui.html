<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Figma Plugin 251121</title>
  <style>
    :root {
      --md-sys-color-surface: rgb(247 249 255);
      --md-sys-color-on-surface: rgb(24 28 32);
      --md-sys-color-surface-variant: rgb(222 227 235);
      --md-sys-color-on-surface-variant: rgb(66 71 78);
      --md-sys-color-primary: rgb(45 98 140);
      --md-sys-color-on-primary: rgb(205 229 255);
      --md-sys-color-secondary: rgb(81 96 111);
      --md-sys-color-on-secondary: rgb(255 255 255);
      --md-sys-color-outline: rgb(114 120 127);
      --md-sys-color-outline-variant: rgb(194 199 207);
      --md-sys-color-surface-container-low: rgb(241 244 249);
      --md-sys-color-surface-container: rgb(236 238 243);
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 16px;
      font-size: 14px;
      line-height: 1.4;
      background: var(--md-sys-color-surface);
      color: var(--md-sys-color-on-surface);
    }

    .container {
      display: flex;
      flex-direction: column;
      gap: 16px;
      padding-bottom: 56px;
    }

    .title {
      font-size: 32px;
      font-weight: 600;
      color: var(--md-sys-color-on-surface);
    }

    .description {
      color: var(--md-sys-color-outline);
      margin-bottom: 16px;
      font-size: 14px;
      line-height: 1.5;
    }

    .button {
      transition: all 0.3s ease;
      padding: 8px 20px 8px 12px;
      border: 1px solid var(--md-sys-color-outline);
      border-radius: 999px;
      background: var(--md-sys-color-surface);
      color: var(--md-sys-color-on-surface);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .button:hover {
      background: var(--md-sys-color-surface-container-low);
    }

    .button.primary {
      flex: 1;
      border: none;
      background: var(--md-sys-color-primary);
      color: var(--md-sys-color-on-primary);
      font-weight: 600;
    }

    .button.primary:hover {
      background: var(--md-sys-color-on-primary);
      color: var(--md-sys-color-primary);
    }

    div small {
      color: var(--md-sys-color-outline);
      font-size: 12px;
      font-family: monospace;
      opacity: 0.75;
      display: block;
      margin: 0 auto;
      text-align: right;
      padding-right: 8px;
    }

    .checkbox-container {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 16px;
    }

    .checkbox-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .checkbox-wrapper input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .checkbox-wrapper label {
      font-weight: 500;
      cursor: pointer;
    }

    .checkbox-description {
      color: var(--md-sys-color-outline);
      font-size: 12px;
      margin-left: 26px;
      line-height: 1.4;
    }

    .element-count {
      background: var(--md-sys-color-surface-container);
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 16px;
    }

    .element-count-label {
      font-size: 12px;
      color: var(--md-sys-color-on-surface-variant);
      margin-bottom: 4px;
    }

    .element-count-value {
      font-size: 24px;
      font-weight: 600;
      color: var(--md-sys-color-on-surface);
    }

    .button-container {
      display: flex;
      gap: 8px;
      margin-top: auto;
      padding-top: 16px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h2 class="title">Figma Plugin 251121</h2>

    <div class="checkbox-container">
      <div class="checkbox-wrapper">
        <input type="checkbox" id="selectionOnly" />
        <label for="selectionOnly">選択範囲のみ</label>
      </div>
      <div class="checkbox-description" id="checkboxDescription">
        現在開いているファイル全体に反映
      </div>
    </div>

    <div class="element-count">
      <div class="element-count-label" id="countLabel">ファイル全体の要素数</div>
      <div class="element-count-value" id="elementCount">0</div>
    </div>

    <div class="button-container">
      <button id="edit" class="button primary">編集</button>
    </div>
  </div>

  <script>
    const checkbox = document.getElementById('selectionOnly');
    const checkboxDescription = document.getElementById('checkboxDescription');
    const countLabel = document.getElementById('countLabel');
    const elementCount = document.getElementById('elementCount');
    const editButton = document.getElementById('edit');

    // チェックボックスの状態変更
    checkbox.addEventListener('change', () => {
      updateDescription();
      requestElementCount();
    });

    function updateDescription() {
      if (checkbox.checked) {
        checkboxDescription.textContent = '選択された要素のみに反映';
      } else {
        checkboxDescription.textContent = '現在開いているファイル全体に反映';
      }
    }

    function requestElementCount() {
      parent.postMessage({
        pluginMessage: {
          type: 'get-element-count',
          selectionOnly: checkbox.checked
        }
      }, '*');
    }

    // 編集ボタンのクリック
    editButton.addEventListener('click', () => {
      parent.postMessage({
        pluginMessage: {
          type: 'edit',
          selectionOnly: checkbox.checked
        }
      }, '*');
    });

    // プラグインからのメッセージを受け取る
    window.addEventListener('message', (event) => {
      const msg = event.data.pluginMessage;
      if (msg && msg.type === 'element-count') {
        elementCount.textContent = msg.count;
        countLabel.textContent = msg.selectionOnly
          ? '選択範囲の要素数'
          : 'ファイル全体の要素数';
      } else if (msg && msg.type === 'selection-changed') {
        // 選択が変更されたときに要素数を再取得
        requestElementCount();
      }
    });

    // 初期化時に要素数を取得
    requestElementCount();
  </script>

</body>

</html>
